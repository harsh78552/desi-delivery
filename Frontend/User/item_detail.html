<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png/jpg" href="../image/myImage.jpg">
    <title>Food Detail</title>

    <style>

        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', sans-serif;
            background: #f2f2f2;
        }

        .card {
            background: white;
            padding: 20px;
            max-width: 500px;
            margin: auto;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            text-align: center;
        }

        img {
            width: 100%;
            height: 260px;
            object-fit: cover;
            border-radius: 12px;
        }

        .qty-box {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 18px;
            margin: 15px 0;
        }

        .qty-btn {
            padding: 8px 16px;
            border: none;
            background: #ffd29f;
            cursor: pointer;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
        }

        .order-btn {
            background: #ff5722;
            color: white;
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border-radius: 8px;
            font-size: 17px;
            border: none;
            cursor: pointer;
        }

        .cart-btn {
            background: #28a745;
            color: white;
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            font-size: 17px;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }

        /* POPUP FIXED + SCROLLABLE */

        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            background: rgba(0,0,0,0.55);
            backdrop-filter: blur(3px);
            padding: 20px;
            overflow-y: auto;
            z-index: 999;
        }

        .popup-content {
            background: #fff;
            width: 360px;
            max-height: 95%;
            overflow-y: auto;
            padding: 20px;
            margin: auto;
            border-radius: 12px;
            animation: fadeIn 0.3s ease-out;
            box-shadow: 0 6px 25px rgba(0,0,0,0.25);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.92); }
            to { opacity: 1; transform: scale(1); }
        }

        .popup-content input,
        .popup-content textarea {
            width: 100%;
            padding: 10px;
            margin: 6px 0 14px;
            font-size: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            outline: none;
        }

        .popup-content input:focus,
        .popup-content textarea:focus {
            border-color: #ff5722;
        }

        .submit-btn {
            background: #ff5722;
            color: white;
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
        }

        .close-btn {
            margin-top: 10px;
            width: 100%;
            padding: 12px;
            background: #c62828;
            color: white;
            border: none;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
        }

    </style>
</head>
<body>

<div id="food-detail">Loading...</div>


<!-- SCROLLABLE ORDER POPUP -->
<div id="order-popup" class="popup">
    <div class="popup-content">
        <h2 style="text-align:center; color:#ff5722; margin-top:5px;">Place Your Order</h2>
        <form id="order-form">

            <label>Name:</label>
            <input type="text" id="user-name" placeholder="Enter your name" required>

            <label>Email:</label>
            <input type="email" id="user-email" placeholder="Enter your email" required>

            <label>Contact Number:</label>
            <input type="text" id="user-contact" placeholder="Enter contact number" required>

            <label>Address:</label>
            <textarea id="user-address" placeholder="Your full address" required></textarea>

            <label>PIN Code:</label>
            <input type="text" id="user-pin" placeholder="6-digit PIN" required>

            <label>State:</label>
            <input type="text" id="user-state" placeholder="State name" required>

            <label>Food Category:</label>
            <input type="text" id="food-category" readonly>

            <label>Food Item:</label>
            <input type="text" id="food-name" readonly>

            <label>Quantity:</label>
            <input type="number" id="food-qty" min="1">

            <button type="submit" class="submit-btn">Submit Order</button>
            <button type="button" onclick="closePopup()" class="close-btn">Cancel</button>

        </form>
    </div>
</div>



<script>

    async function loadFoodDetail() {
        const category = localStorage.getItem("selectedCategory");
        const itemName = localStorage.getItem("selectedItemName");
        const token = localStorage.getItem("userToken");

        if (!category || !itemName) {
            document.getElementById("food-detail").innerHTML =
                "<b>No item selected.</b>";
            return;
        }

        try {
            const res = await fetch(
                `https://desi-delivery.onrender.com/menu/item?category=${category}&item_name=${itemName}`,
                {
                    method: "GET",
                    headers: { "Authorization": "Bearer " + token }
                }
            );

            const item = await res.json();
            window.currentItem = item;

            document.getElementById("food-detail").innerHTML = `
                <div class="card">
                    <img src="${item.image_url}" alt="food">
                    <h2>${item.food_name}</h2>
                    <p>${item.descriptions}</p>
                    <h3>â‚¹${item.price}</h3>

                    <div class="qty-box">
                        <button class="qty-btn" onclick="changeQty(-1)">-</button>
                        <span id="qty" style="font-size:18px;">1</span>
                        <button class="qty-btn" onclick="changeQty(1)">+</button>
                    </div>

                    <button class="cart-btn" onclick="addToCart()">Add to Cart</button>
                    <button class="order-btn" onclick="openOrderForm()">Order Now</button>
                </div>
            `;
        }
        catch (err) {
            document.getElementById("food-detail").innerHTML =
                "<b>Error loading item.</b>";
        }
    }

    function changeQty(value) {
        let qty = parseInt(document.getElementById("qty").innerText);
        qty += value;
        if (qty < 1) qty = 1;
        document.getElementById("qty").innerText = qty;
    }

    function addToCart() {
        const qty = parseInt(document.getElementById("qty").innerText);
        alert("Added to cart - Qty: " + qty);
    }

    /* POPUP FUNCTIONS */

    function openOrderForm() {
        const qty = document.getElementById("qty").innerText;

        document.getElementById("food-category").value = currentItem.sub_category;
        document.getElementById("food-name").value = currentItem.food_name;
        document.getElementById("food-qty").value = qty;

        document.getElementById("order-popup").style.display = "flex";
    }

    function closePopup() {
        document.getElementById("order-popup").style.display = "none";
    }

    document.getElementById("order-form").addEventListener("submit", function(e){
        e.preventDefault();

        alert("Order submitted successfully!");

        closePopup();
    });

    loadFoodDetail();

</script>

</body>
</html>
