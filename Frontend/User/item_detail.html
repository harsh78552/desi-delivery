<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png/jpg" href="../image/myImage.jpg">
    <title>Food Detail</title>

    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial;
            background: #f5f5f5;
        }

        .card {
            background: white;
            padding: 20px;
            max-width: 500px;
            margin: auto;
            border-radius: 15px;
            box-shadow: 0 4px 10px #bbb;
            text-align: center;
        }

        img {
            width: 100%;
            height: 260px;
            object-fit: cover;
            border-radius: 10px;
        }

        .qty-box {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }

        button {
            padding: 10px 20px;
            border: none;
            background: orange;
            cursor: pointer;
            border-radius: 6px;
            font-size: 16px;
        }

        .order-btn { background: #ff6600; color: white; }
        .cart-btn { background: #28a745; color: white; }

        /* POPUP STYLES */
        .popup {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .popup-content {
            background: white;
            padding: 20px;
            width: 350px;
            border-radius: 10px;
            box-shadow: 0 5px 15px #444;
        }

        .popup-content input,
        .popup-content textarea {
            width: 100%;
            padding: 8px;
            margin: 6px 0 12px;
            font-size: 14px;
        }

        .submit-btn {
            background: green;
            color: #fff;
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: none;
            margin-top: 10px;
        }

        .close-btn {
            margin-top: 10px;
            width: 100%;
            padding: 10px;
            background: red;
            color: white;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<div id="food-detail">Loading...</div>

<!-- ORDER POPUP FORM -->
<div id="order-popup" class="popup">
    <div class="popup-content">
        <h2>Place Your Order</h2>
        <form id="order-form">

            <label>Name:</label>
            <input type="text" id="user-name" required>

            <label>Email:</label>
            <input type="email" id="user-email" required>

            <label>Contact Number:</label>
            <input type="text" id="user-contact" required>

            <label>Address:</label>
            <textarea id="user-address" required></textarea>

            <label>PIN Code:</label>
            <input type="text" id="user-pin" required>

            <label>State:</label>
            <input type="text" id="user-state" required>

            <label>Food Category:</label>
            <input type="text" id="food-category" readonly>

            <label>Food Item:</label>
            <input type="text" id="food-name" readonly>

            <label>Quantity:</label>
            <input type="number" id="food-qty" min="1">

            <button type="submit" class="submit-btn">Submit Order</button>
            <button type="button" onclick="closePopup()" class="close-btn">Cancel</button>

        </form>
    </div>
</div>


<script>

    async function loadFoodDetail() {
        const category = localStorage.getItem("selectedCategory");
        const itemName = localStorage.getItem("selectedItemName");
        const token = localStorage.getItem("userToken");

        if (!category || !itemName) {
            document.getElementById("food-detail").innerHTML =
                "<b>No item selected.</b>";
            return;
        }

        try {
            const res = await fetch(
                `https://desi-delivery.onrender.com/menu/item?category=${category}&item_name=${itemName}`,
                {
                    method: "GET",
                    headers: { "Authorization": "Bearer " + token }
                }
            );

            const item = await res.json();
            window.currentItem = item; // store globally

            document.getElementById("food-detail").innerHTML = `
                <div class="card">
                    <img src="${item.image_url}" alt="">
                    <h2>${item.food_name}</h2>
                    <p>${item.descriptions}</p>
                    <h3>â‚¹${item.price}</h3>

                    <div class="qty-box">
                        <button onclick="changeQty(-1)">-</button>
                        <span id="qty">1</span>
                        <button onclick="changeQty(1)">+</button>
                    </div>

                    <button class="cart-btn" onclick="addToCart()">Add to Cart</button>

                    <button class="order-btn"
                        onclick='openOrderForm()'>
                        Order Now
                    </button>
                </div>
            `;
        }
        catch (err) {
            document.getElementById("food-detail").innerHTML =
                "<b>Error loading item.</b>";
            console.log(err);
        }
    }

    function changeQty(value) {
        let qty = parseInt(document.getElementById("qty").innerText);
        qty += value;
        if (qty < 1) qty = 1;
        document.getElementById("qty").innerText = qty;
    }

    function addToCart() {
        const qty = parseInt(document.getElementById("qty").innerText);
        alert("Added to cart - Qty: " + qty);
    }

    /* ---------------------------
        ORDER POPUP FUNCTIONS
    ---------------------------- */

    function openOrderForm() {
        const qty = document.getElementById("qty").innerText;

        document.getElementById("food-category").value = currentItem.sub_category;
        document.getElementById("food-name").value = currentItem.food_name;
        document.getElementById("food-qty").value = qty;

        document.getElementById("order-popup").style.display = "flex";
    }

    function closePopup() {
        document.getElementById("order-popup").style.display = "none";
    }

    document.getElementById("order-form").addEventListener("submit", function(e){
        e.preventDefault();

        alert("Order submitted successfully!");
        closePopup();
    });

    loadFoodDetail();

</script>

</body>
</html>
