<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Place Order</title>
    <style>
        body { font-family: Arial; background:#f4f4f4; padding:20px; }
        .form-box {
            max-width:420px;
            margin:auto;
            background:white;
            padding:20px;
            border-radius:12px;
            box-shadow:0 4px 15px rgba(0,0,0,0.2);
        }
        input, textarea {
            width:100%; padding:10px; margin:8px 0;
            border:1px solid #ddd; border-radius:8px;
        }
        button {
            width:100%; padding:12px;
            background:#ff5722; color:white;
            border:none; border-radius:8px;
            cursor:pointer; font-size:17px;
        }
    </style>
</head>
<body>

<div class="form-box">
    <h2>Order Details</h2>

    <form id="submit-order">

        <label>Your Name</label>
        <input id="user-name" required>

        <label>Email</label>
        <input id="user-email" required>

        <label>Contact</label>
        <input id="user-contact" required>

        <label>Address</label>
        <textarea id="user-address" required></textarea>

        <label>PIN</label>
        <input id="user-pin" required>

        <h3>Food Information</h3>

        <label>Category</label>
        <input id="food-category" readonly>

        <label>Food Name</label>
        <input id="food-name" readonly>

        <label>Quantity</label>
        <input id="food-qty" readonly>

        <label>Total Price</label>
        <input id="food-total" readonly>

        <button type="submit">Submit Order</button>
    </form>
</div>


<script>
    // Load data from localStorage
    const category = localStorage.getItem("orderCategory");
    const name = localStorage.getItem("orderItem");
    const qty = parseInt(localStorage.getItem("orderQty"));
    const price = parseInt(localStorage.getItem("orderPrice"));
    const total = qty * price;

    // SHOW IN FORM
    document.getElementById("food-category").value = category;
    document.getElementById("food-name").value = name;
    document.getElementById("food-qty").value = qty;
    document.getElementById("food-total").value = "â‚¹" + total;

    // SUBMIT ORDER
    document.getElementById("submit-order").addEventListener("submit", async function(e){
        e.preventDefault();

        const orderData = {
            user_name: document.getElementById("user-name").value,
            user_email: document.getElementById("user-email").value,
            user_contact: document.getElementById("user-contact").value,
            delivery_address: document.getElementById("user-address").value,
            pin_code: document.getElementById("user-pin").value,

            food_category: category,
            food_name: name,
            quantity: qty,
            price: total
        };

        const token = localStorage.getItem("userToken");

        const res = await fetch("https://desi-delivery.onrender.com/item-order", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify(orderData)
        });

        const data = await res.json();

        console.log("API Status:", res.status);
        console.log("Backend Response:", data);

        if(res.ok){
            alert("Order placed successfully!");
            window.location.href = "menu.html";
        } else {
            alert("Something went wrong!");
        }
    });
</script>


</body>
</html>
