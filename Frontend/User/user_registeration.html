<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Menu</title>
    <style>
        body {
            font-family: Arial;
            padding: 0;
            margin: 0;
            background: #f2f2f2;
        }

        /* NAVBAR (Amazon style) */
        .navbar {
            width: 100%;
            background: #131921;
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-left {
            font-size: 22px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .nav-categories {
            display: flex;
            gap: 20px;
            margin-left: 40px;
        }

        .nav-categories span {
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 4px;
            transition: 0.2s;
        }

        .nav-categories span:hover {
            background: #232f3e;
        }

        .nav-right {
            display: flex;
            gap: 15px;
        }

        .nav-right button {
            padding: 6px 12px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        .profile-btn { background: #ff9900; }
        .about-btn { background: #ffa31a; }
        .logout-btn { background: #e65c00; color: white; }

        /* CATEGORY BOXES */
        .category-box {
            background: white;
            padding: 15px;
            margin: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 5px #ccc;
        }

        .food-card {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: 0.2s;
        }

        .food-card:hover {
            box-shadow: 0 4px 10px #bbb;
        }

        .food-card img {
            width: 120px;
            height: 90px;
            object-fit: cover;
            border-radius: 8px;
        }

        /* Toast messages */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: #fff;
            padding: 12px 20px;
            border-radius: 6px;
            opacity: 0.95;
            font-size: 14px;
            z-index: 1000;
            animation: fadeOut 3s forwards;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .toast.success { background: #28a745; }
        .toast.error { background: #dc3545; }
        .toast.info { background: #007bff; }

        @keyframes fadeOut {
            0% { opacity: 0.95; }
            80% { opacity: 0.95; }
            100% { opacity: 0; }
        }

    </style>
</head>
<body>

<div class="navbar">
    <div class="nav-left">Food Ordering</div>

    <div class="nav-categories" id="category-list">
        <!-- Categories will auto-load here -->
    </div>

    <div class="nav-right">
        <button class="profile-btn" onclick="goProfile()">Profile</button>
        <button class="about-btn" onclick="goAbout()">About</button>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
</div>

<h2 style="padding-left: 25px;">Menu Items</h2>
<div id="menu-container" style="padding: 20px;">Loading...</div>

<script>
    // Load Menu
    async function loadMenu() {
        const token = localStorage.getItem("userToken");

        if (!token) {
            showToast("Please login first!", "error");
            document.getElementById("menu-container").innerHTML =
                "<b>No token found. Please login first.</b>";
            return;
        }

        try {
            const res = await fetch("https://restaurantfoodorderingsystem-6.onrender.com/menu", {
                method: "GET",
                headers: {
                    "Authorization": "Bearer " + token,
                    "Content-Type": "application/json"
                }
            });

            const menuData = await res.json();
            const container = document.getElementById("menu-container");
            const navbarCategories = document.getElementById("category-list");

            container.innerHTML = "";
            navbarCategories.innerHTML = "";

            menuData.forEach(cat => {
                // Navbar category
                const catTab = document.createElement("span");
                catTab.innerText = cat.category;
                catTab.onclick = () => scrollToCategory(cat.category);
                navbarCategories.appendChild(catTab);

                // Category box
                const box = document.createElement("div");
                box.classList.add("category-box");
                box.id = cat.category.replace(/\s+/g, "-");

                const itemsHTML = cat.items.map(item => `
                    <div class="food-card" onclick="viewFoodDetail('${item._id}')">
                        <img src="${item.image_url}" alt="">
                        <div>
                            <h4>${item.food_name}</h4>
                            <p>${item.descriptions}</p>
                            <b>Price: ${item.price}</b><br>
                            <small>Category: ${item.sub_category}</small>
                        </div>
                    </div>
                `).join("");

                box.innerHTML = `<h3>${cat.category}</h3>${itemsHTML}`;
                container.appendChild(box);
            });

        } catch (err) {
            console.error(err);
            showToast("Error loading menu.", "error");
            document.getElementById("menu-container").innerHTML = "<b>Error loading menu.</b>";
        }
    }

    // Scroll to category section
    function scrollToCategory(catName) {
        const id = catName.replace(/\s+/g, "-");
        const section = document.getElementById(id);
        section.scrollIntoView({ behavior: "smooth" });
    }

    // View food detail
    function viewFoodDetail(foodId) {
        localStorage.setItem("selectedFoodId", foodId);
        window.location.href = "food_detail.html";
    }

    // Profile button
    function goProfile() {
        const token = localStorage.getItem("userToken");
        if (!token) {
            showToast("Please login first!", "error");
            window.location.href = "user_login.html";
            return;
        }
        window.location.href = "profile.html";
    }

    // About button
    function goAbout() {
         const token = localStorage.getItem("userToken");
        if (!token) {
            showToast("Please login first!", "error");
            window.location.href = "user_login.html";
            return;
        }
        window.location.href = "about_us.html";
    }

    // Logout
    function logout() {
        localStorage.removeItem("userToken");
        showToast("Logged out successfully!", "success");
        setTimeout(() => window.location.href = "user_login.html", 1000);
    }

    // Toast function
    function showToast(message, type="info") {
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.innerText = message;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, 3000);
    }

    loadMenu();
</script>

</body>
</html>
