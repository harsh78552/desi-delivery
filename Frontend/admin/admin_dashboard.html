<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="icon" type="image/png/jpg" href="../image/myImage.jpg">
    <script>
        const token = localStorage.getItem("VyanjanamAdminToken");

        function redirectToLogin() {
          localStorage.removeItem("VyanjanamAdminToken");
          window.location.href = "admin_login.html";
        }

        if (token) {
          try {
            const parts = token.split(".");
            if (parts.length !== 3) throw new Error("Invalid token format");

            const payload = JSON.parse(atob(parts[1]));
            const expiry = payload.exp;
            const role = payload.role;
            const now = Math.floor(Date.now() / 1000);

            if (now > expiry || role !== "admin") {
              redirectToLogin();
            }
          } catch (err) {
            console.error("Token Error:", err);
            redirectToLogin();
          }
        } else {
          redirectToLogin();
        }
    </script>
    <style>
        body {
          margin: 0;
          font-family: Arial, sans-serif;
          display: flex;
          flex-direction: column;
          height: 100vh;
        }

        /* Navbar */
        .navbar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          background: #333;
          color: #fff;
          padding: 10px 20px;
        }
        .navbar .buttons button {
          background: #333;
          color: #fff;
          border: none;
          padding: 8px 12px;
          margin-left: 10px;
          border-radius: 4px;
          cursor: pointer;
          transition: 0.2s;
        }
        .navbar .buttons button:hover {
          background: pink;
        }

        /* Layout */
        .main {
          flex: 1;
          display: flex;
        }

        /* Sidebar */
        .sidebar {
          width: 220px;
          background: #f4f4f4;
          padding: 20px;
          box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        .sidebar h3 {
          margin-top: 20px;
          margin-bottom: 10px;
          font-size: 16px;
          color: #555;
          border-bottom: 1px solid #ccc;
          padding-bottom: 5px;
        }
        .sidebar button {
          display: block;
          width: 100%;
          margin: 5px 0;
          padding: 10px;
          background: #ddd;
          border: none;
          border-radius: 6px;
          text-align: left;
          cursor: pointer;
          font-size: 15px;
          transition: 0.2s;
        }
        .sidebar button:hover {
          background: pink;
          color: #fff;
        }

        /* Content */
        .content {
          flex: 1;
          padding: 20px;
          background: #fff;
        }
    </style>
</head>
<body>
<!-- Navbar -->
<div class="navbar">
    <div class="title">Admin Panel</div>
    <div class="buttons">
        <button onclick="goToPage('profile.html')">Profile</button>
        <button onclick="logout()">Logout</button>
    </div>
</div>

<!-- Layout -->
<div class="main">
    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Items Management -->
        <h3>Items Management</h3>
        <button onclick="goToPage('add_items.html')">Add Items</button>
        <button onclick="goToPage('view_all_items.html')">View Items</button>
        <button onclick="goToPage('update_item.html')">Edit Items</button>
        <button onclick="goToPage('delete_item.html')">Delete Items</button>

        <!-- Staff Management -->
        <h3>Staff Management</h3>
        <button onclick="goToPage('add_staff.html')">Add Staff</button>
        <button onclick="goToPage('view_all_staff.html')">View Staff</button>
        <button onclick="goToPage('update_staff_data.html')">Update Staff</button>
        <button onclick="goToPage('delete_staff.html')">Delete Staff</button>

        <!-- Orders / Reports -->
        <h3>Orders & Reports</h3>
        <button onclick="goToPage('all_orders.html')">View Orders</button>
        <button onclick="goToPage('sales_report.html')">Sales Report</button>
    </div>

    <!-- Content Area -->

</div>

<script>

    function goToPage(page) {
      window.location.href = page;
    }

    async function logout() {
      try {
        await fetch(" https://desi-delivery.onrender.com/admin-logout", {
          method: "POST",
          headers: { Authorization: "Bearer " + token,"Content-Type": "application/json" }
        });
      } finally {
        localStorage.removeItem("VyanjanamAdminToken");
        window.location.replace("admin_login.html");
      }
    }
</script>
</body>
</html>
